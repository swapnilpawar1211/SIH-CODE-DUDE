<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>attenD ‚Äî Face Recognition Attendance (Frontend)</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- face-api.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js"></script>

</head>

<body>

    <!-- Splash -->
    <div id="splash">
        <div class="box text-center">
            <div style="font-size:28px;font-weight:800">attenD</div>
            <div class="muted">Loading models & UI ‚Äî please wait</div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div style="font-weight:700; font-size:20px;">attenD</div>
    </header>

    <div class="container-main">
        <!-- LOGIN -->
        <div id="loginCard" class="card fade-in">
            <h3>Login</h3>
            <div class="row g-2 mt-2">
                <div class="col"><button class="btn btn-primary w-100" onclick="showTeacherLogin()">Teacher
                        Login</button></div>
                <div class="col"><button class="btn btn-outline-secondary w-100" onclick="showStudentLogin()">Student
                        Login</button></div>
            </div>
            <div id="teacherBox" class="hidden mt-3">
                <input id="tuser" class="form-control mb-2" placeholder="username (teacher1)" />
                <div class="input-group mb-2">
                    <input id="tpass" type="password" class="form-control" placeholder="password (pass123)" />
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword()">üëÅ</button>
                </div>
                <div class="d-flex gap-2 mb-2">
                    <button class="btn btn-primary flex-grow-1" onclick="doTeacherLogin()">Login as Teacher</button>
                    <button class="btn btn-link text-decoration-none" onclick="openForgot()">Forgot?</button>
                </div>
            </div>
            <div id="studentBox" class="hidden mt-3">
                <input id="sroll" class="form-control mb-2" placeholder="Enter roll number (e.g. 1A-01)" />
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-secondary" onclick="doStudentLogin()">View My Report</button>
                </div>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div id="dashCard" class="card mt-4 hidden fade-in">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <h4>Teacher Dashboard</h4>
                <div>
                    <button class="btn btn-info me-2" onclick="openHelp()">Help</button>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>
            <div class="stat-grid mt-3">
                <div class="stat">Total Students<br>
                    <div id="totStud">0</div>
                </div>
                <div class="stat">Present Today<br>
                    <div id="presStud">0</div>
                </div>
                <div class="stat">Absent Today<br>
                    <div id="absStud">0</div>
                </div>
            </div>
            <div class="mt-3 d-grid gap-2">
                <button class="btn btn-primary" onclick="openEnroll()">Enroll Students</button>
                <button class="btn btn-success" onclick="openAttend()">Start Attendance</button>
                <button class="btn btn-outline-secondary" onclick="openReport()">Reports</button>
                <button class="btn btn-outline-primary" onclick="exportClassReport()">Export Report (PDF)</button>
                <button class="btn btn-danger" onclick="clearAllStudents()">Clear All Students</button>
            </div>
        </div>

        <!-- ENROLL -->
        <div id="enrollCard" class="card mt-4 hidden fade-in">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <h4>Enroll Student</h4>
                <div><button class="btn btn-outline-secondary" onclick="backToDash()">Back</button></div>
            </div>
            <div class="mt-2">
                <input id="enrollRoll" class="form-control mb-2" placeholder="Roll number e.g. 1A-01">
                <div class="muted mb-2">Position face and press Capture (3 samples).</div>
                <video id="enrollVideo" autoplay muted playsinline
                    style="width:100%;height:320px;object-fit:cover;border-radius:8px;background:#e9eef8"></video>
                <div class="d-grid gap-2 mt-2">
                    <button class="btn btn-primary" onclick="captureMultiAndEnroll()">Capture & Enroll</button>
                    <button class="btn btn-outline-secondary" onclick="stopEnrollCamera()">Stop Camera</button>
                </div>
            </div>
        </div>

        <!-- ATTENDANCE -->
        <div id="attendCard" class="card mt-4 hidden fade-in">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <h4>Live Attendance</h4>
                <div><button class="btn btn-outline-secondary" onclick="stopAttendance()">Stop</button></div>
            </div>
            <div class="mt-2">
                <video id="attendVideo" autoplay muted playsinline
                    style="width:100%;height:360px;object-fit:cover;border-radius:8px;background:#e9eef8"></video>
                <div class="mt-3">
                    <h6 class="muted">Recognized</h6>
                    <div id="recognizedWrap" style="display:flex;flex-wrap:wrap"></div>
                </div>
                <div class="mt-3">
                    <h6 class="muted">Snapshot gallery</h6>
                    <div id="snapshotGallery" style="display:flex;gap:8px;overflow:auto;padding-top:8px"></div>
                </div>
            </div>
        </div>

        <!-- REPORT -->
        <div id="reportCard" class="card mt-4 hidden fade-in">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <h4>Class Report</h4>
                <div><button class="btn btn-outline-secondary" onclick="backToDash()">Back</button></div>
            </div>
            <div style="margin-top:10px"><canvas id="classChart" style="max-width:420px"></canvas></div>
            <div style="margin-top:10px"><canvas id="timelineChart" style="max-width:700px"></canvas></div>
            <div class="mt-3">
                <h6 class="muted">Students</h6>
                <div id="studentList"></div>
            </div>
        </div>

        <!-- STUDENT REPORT -->
        <div id="studentReportCard" class="card mt-4 hidden fade-in">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <h4>Student Analytics ‚Äî <span id="srRoll"></span></h4>
                <div><button class="btn btn-outline-secondary" onclick="backToDash()">Back</button></div>
            </div>
            <div style="margin-top:10px"><canvas id="studentChart" style="max-width:320px"></canvas></div>
            <div class="mt-3">
                <h6 class="muted">Attendance history</h6>
                <ul id="srHistory" class="list-group mt-2" style="max-height:240px;overflow:auto"></ul>
                <button class="btn btn-outline-primary mt-2" onclick="exportStudentReport()">Export My Report</button>
            </div>
        </div>
    </div>

    <!-- HELP MODAL -->
    <div id="helpModal">
        <div id="helpBox">
            <h5>How to Use attenD</h5>
            <ul>
                <li>Enroll students by capturing faces.</li>
                <li>Start attendance ‚Äî auto mark present.</li>
                <li>View Reports and export PDFs.</li>
            </ul>
            <div class="text-end"><button class="btn btn-primary btn-sm" onclick="closeHelp()">Close</button></div>
        </div>
    </div>

    <!-- FORGOT PASSWORD MODAL -->
    <div id="forgotModal">
        <div id="forgotBox">
            <h5>Reset Teacher Password</h5>
            <input id="fpUser" class="form-control mb-2" placeholder="teacher username (teacher1)" />
            <input id="fpPass" type="password" class="form-control mb-2" placeholder="new password" />
            <input id="fpPass2" type="password" class="form-control mb-2" placeholder="confirm password" />
            <div class="text-end">
                <button class="btn btn-secondary btn-sm" onclick="closeForgot()">Cancel</button>
                <button class="btn btn-primary btn-sm" onclick="doResetPassword()">Reset</button>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>¬© 2025 attenD ‚Äî Contact: <a href="mailto:swapnilpawarworks@gmail.com">swapnilpawarworks@gmail.com</a>
    </footer>


</body>

</html>